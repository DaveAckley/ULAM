## -*- mode:ulam -*-
#=t41209_test_compiler_elementwithclassparameterquarkunion
##
##  gen output: (1 assert)
##   Int(3) : -4
##
#!
Exit status: -4
Ue_T { Int(32) test() {  System sys;  constant Q q = { .b = true };  S(10131Q10c30x4) s;  sys ( s -4 . )print . sys ( s -4 . -4 == )assert . s -4 . cast return } }
Uq_System { <NOMAIN> }
Uq_Q { Bool(1) b(false);  Int(3) i(0);  <NOMAIN> }
Uq_S(Q v) { constant Int(3) csi = v i .;  <NOMAIN> }
##
##    //informed by t3451
##
#>T.ulam
 ulam 1;
element T{
  Int test(){
    System sys;
    constant Q q = { .b = true};
    //    q.b = true; can't update a constant.
    S(q) s;
    sys.print(s.csi);
    sys.assert(s.csi == Int(3).minof); //-4

    return s.csi; //-4
  }
}

#:S.ulam
  ulam 1;
quark S(Q v){
  constant Int(3) csi = v.i; //we're all constants here, right?
}

#:Q.ulam
  ulam 1;
union Q{
  Bool b;
  Int(3) i;
}

#:System.ulam
ulam 1;
quark System {
Void print(Unsigned arg) native;
Void print(Int arg) native;
Void print(Int(4) arg) native;
Void print(Int(3) arg) native;
Void print(Unary(3) arg) native;
Void print(Bool(3) arg) native;
Void assert(Bool b) native;
}
#.
