## -*- mode:ulam -*-
#=t41316_test_compiler_transientandquark_multibases_virtualfuncsselectwdatamembersandtypedefs
##
## gen output:
## Int Arg: 212 (+ 1 assert)
## Int Arg: 110 (+ 4 asserts)
## Int Arg: 110 (+ 3 asserts)
##
#!
Exit status: 0
Ue_Foo +System { +<> Int(32) m_c4(212);  Int(32) m_a4(110);  Int(32) test() {  T4 t4;  typedef QBase2 QB2;  m_c4 t4 QB2 . ( )vfuncc . = ( m_c4 )print ( m_c4 212 cast == )assert typedef QBase1 QB1;  m_a4 t4 QBase3 . QB1 . ( )vfunca . = ( m_a4 )print ( m_a4 110 cast == )assert ( t4 QBase3 . QBase1 . m_b1 . )assert ( t4 m_b1 . ! )assert ( t4 QBase1 . m_b1 . ! )assert Int(32) a4 = t4 QBase1 . ( )vfunca .;  ( a4 )print ( a4 110 cast == )assert ( t4 QBase1 . m_b1 . )assert ( t4 m_b1 . )assert 0 cast return } }
Uq_System { <NOMAIN> }
Un_T4 : QBase3 +QBase2 +QBase1 { :< :< Bool(1) m_b1(false); > Bool(1) m_b3(false); > +< Bool(1) m_b2(false); > +< Bool(1) m_b1(false); > typedef QBase2 QB2;  <NOMAIN> }
Un_QBase3 : QBase1 { :< Bool(1) m_b1(false); > Bool(1) m_b3(false);  <NOMAIN> }
Uq_QBase1 { Bool(1) m_b1(false);  <NOMAIN> }
Uq_QBase2 { Bool(1) m_b2(false);  <NOMAIN> }
##
##       informed by t41310; uses transient T4 instead of element E4, and transient base (QBase3).
##
#>Foo.ulam
  ulam 4;
element Foo +System {
  Int m_c4;
  Int m_a4;

  Int test()
  {
    T4 t4;

    typedef T4.QB2 QB2;
    m_c4 = t4.QB2.vfuncc(); //212
    print(m_c4);
    assert(m_c4==212);

    typedef QBase3.Super QB1;
    m_a4 = t4.QBase3.QB1.vfunca(); //110
    print(m_a4);
    assert(m_a4==110);
    assert(t4.QBase3.QBase1.m_b1); //changed
    assert(!t4.m_b1); //unchanged w extra +QBase1
    assert(!t4.QBase1.m_b1); //unchanged

    Int a4 = t4.QBase1.vfunca(); //110
    print(a4);
    assert(a4==110);
    assert(t4.QBase1.m_b1); //changed
    assert(t4.m_b1); //unchanged

    return 0;
  }
}


#:T4.ulam
  ulam 4;
transient T4 : QBase3 +QBase2 +QBase1 {
  virtual Int vfuncc() { return 412; }
  virtual Int vfunca() { return 410; }
  virtual Void behave() { }
  typedef QBase2 QB2;
}

#:QBase1.ulam
    ulam 4;
quark QBase1 {
  Bool m_b1;
  Void funcNotVirtualSoIrrelevantHere() { }
  virtual Int vfunca() { m_b1 = true; return 110; }
}

#:QBase2.ulam
  ulam 4;
quark QBase2 {
  Bool m_b2;
  virtual ARGB getColor(Unsigned s) { return super.getColor(s); }
  virtual Int vfuncc() { m_b2 = true; return 212; }
}

#:QBase3.ulam
  ulam 4;
transient QBase3 : QBase1 {
  Bool m_b3;
  virtual Int vfuncb() { return 311; }
  virtual Int vfunca() { m_b3 = true; return 310; }
}


#:System.ulam
ulam 1;
quark System {
Void print(Unsigned arg) native;
Void print(Int arg) native;
Void print(Int(4) arg) native;
Void print(Int(3) arg) native;
Void print(Unary(3) arg) native;
Void print(Bool(3) arg) native;
Void assert(Bool b) native;
}

#.
